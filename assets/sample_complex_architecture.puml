@startuml Complex Trading System Architecture
!theme strategient from ../assets/plantuml/themes

title Quantitative Trading Platform - Full Architecture

' ============================================
' EXTERNAL DATA SOURCES
' ============================================
cloud "Market Data Providers" as ext_market {
    component "Bloomberg" as bloomberg
    component "Reuters" as reuters
    component "IEX Cloud" as iex
    component "Polygon.io" as polygon
}

cloud "Alternative Data" as ext_alt {
    component "Satellite Imagery" as satellite
    component "Web Scraping" as webscrape
    component "Social Sentiment" as sentiment
    component "News Feeds" as newsfeed
}

' ============================================
' DATA INGESTION LAYER
' ============================================
rectangle "Data Ingestion Layer" as ingestion {
    component "Feed Handler A" as feed_a
    component "Feed Handler B" as feed_b
    component "Feed Handler C" as feed_c
    component "Alt Data Processor" as alt_proc
    queue "Raw Data Queue" as raw_queue
    component "Data Normalizer" as normalizer
    component "Symbol Mapper" as symbol_map
    component "Corporate Actions" as corp_actions
}

' ============================================
' DATA STORAGE LAYER
' ============================================
rectangle "Data Storage Layer" as storage {
    database "Tick DB\n(TimescaleDB)" as tick_db
    database "OHLCV Store\n(ClickHouse)" as ohlcv_db
    database "Reference Data\n(PostgreSQL)" as ref_db
    database "Alt Data Lake\n(S3/Parquet)" as alt_lake
    storage "Feature Store\n(Redis)" as feature_store
    database "Model Registry\n(MLflow)" as model_reg
}

' ============================================
' FEATURE ENGINEERING
' ============================================
rectangle "Feature Engineering" as features {
    component "Technical Indicators" as tech_ind
    component "Fundamental Ratios" as fund_ratios
    component "Microstructure Features" as micro_feat
    component "Cross-Asset Features" as cross_feat
    component "Alt Data Features" as alt_feat
    component "Feature Pipeline\nOrchestrator" as feat_orch
}

' ============================================
' ALPHA GENERATION
' ============================================
rectangle "Alpha Generation" as alpha {
    component "Momentum Alpha" as alpha_mom
    component "Mean Reversion" as alpha_mr
    component "Statistical Arb" as alpha_stat
    component "ML Alpha\n(XGBoost)" as alpha_ml
    component "DL Alpha\n(Transformer)" as alpha_dl
    component "NLP Alpha\n(Sentiment)" as alpha_nlp
    component "Alpha Combiner" as alpha_comb
    component "Signal Decay\nModel" as signal_decay
}

' ============================================
' RISK MANAGEMENT
' ============================================
rectangle "Risk Management" as risk {
    component "Pre-Trade Risk" as pre_risk
    component "Real-Time Risk" as rt_risk
    component "VaR Calculator" as var_calc
    component "Stress Testing" as stress
    component "Margin Manager" as margin
    component "Exposure Limits" as exp_limits
    component "Correlation\nMonitor" as corr_mon
}

' ============================================
' PORTFOLIO OPTIMIZATION
' ============================================
rectangle "Portfolio Construction" as portfolio {
    component "Universe Filter" as univ_filter
    component "Optimizer\n(Convex)" as optimizer
    component "Transaction Cost\nModel" as tcost
    component "Constraints\nEngine" as constraints
    component "Rebalancer" as rebalancer
    component "Tax Lot\nOptimizer" as tax_lot
}

' ============================================
' EXECUTION LAYER
' ============================================
rectangle "Execution Layer" as execution {
    component "Order Manager" as order_mgr
    component "Smart Order\nRouter" as sor
    component "TWAP Algo" as twap
    component "VWAP Algo" as vwap
    component "Implementation\nShortfall" as impl_short
    component "Dark Pool\nAggregator" as dark_pool
    queue "Order Queue" as order_queue
}

' ============================================
' BROKER CONNECTIVITY
' ============================================
rectangle "Broker Connectivity" as brokers {
    component "FIX Gateway A" as fix_a
    component "FIX Gateway B" as fix_b
    component "REST API\nConnector" as rest_conn
    component "Drop Copy\nHandler" as drop_copy
}

' ============================================
' POSITION & ACCOUNTING
' ============================================
rectangle "Position Management" as positions {
    database "Position Store" as pos_db
    component "P&L Calculator" as pnl_calc
    component "Trade Blotter" as blotter
    component "Reconciliation" as recon
    component "Settlement\nTracker" as settle
}

' ============================================
' MONITORING & ANALYTICS
' ============================================
rectangle "Monitoring & Analytics" as monitoring {
    component "Performance\nAttribution" as perf_attr
    component "Execution\nAnalytics" as exec_analytics
    component "System Health" as sys_health
    component "Alert Manager" as alerts
    component "Dashboard\nAggregator" as dashboard
    database "Metrics Store\n(Prometheus)" as metrics_db
}

' ============================================
' BACKTESTING
' ============================================
rectangle "Research & Backtest" as backtest {
    component "Backtest Engine" as bt_engine
    component "Event Simulator" as event_sim
    component "Slippage Model" as slip_model
    component "Walk-Forward\nAnalyzer" as walk_fwd
    component "Monte Carlo\nSim" as monte_carlo
}

' ============================================
' INFRASTRUCTURE
' ============================================
rectangle "Infrastructure" as infra {
    node "Kubernetes\nCluster" as k8s
    component "Service Mesh\n(Istio)" as istio
    queue "Message Bus\n(Kafka)" as kafka
    component "Config Server" as config
    component "Secrets Vault" as vault
    component "Log Aggregator\n(ELK)" as elk
}

' ============================================
' CONNECTIONS - Data Flow
' ============================================
' External to Ingestion
bloomberg --> feed_a
reuters --> feed_b
iex --> feed_c
polygon --> feed_c
satellite --> alt_proc
webscrape --> alt_proc
sentiment --> alt_proc
newsfeed --> alt_proc

' Ingestion internal
feed_a --> raw_queue
feed_b --> raw_queue
feed_c --> raw_queue
alt_proc --> raw_queue
raw_queue --> normalizer
normalizer --> symbol_map
symbol_map --> corp_actions

' Ingestion to Storage
corp_actions --> tick_db
corp_actions --> ohlcv_db
normalizer --> ref_db
alt_proc --> alt_lake

' Storage to Features
tick_db --> tech_ind
ohlcv_db --> tech_ind
ohlcv_db --> fund_ratios
tick_db --> micro_feat
ohlcv_db --> cross_feat
alt_lake --> alt_feat
feat_orch --> feature_store

tech_ind --> feat_orch
fund_ratios --> feat_orch
micro_feat --> feat_orch
cross_feat --> feat_orch
alt_feat --> feat_orch

' Features to Alpha
feature_store --> alpha_mom
feature_store --> alpha_mr
feature_store --> alpha_stat
feature_store --> alpha_ml
feature_store --> alpha_dl
feature_store --> alpha_nlp

alpha_mom --> alpha_comb
alpha_mr --> alpha_comb
alpha_stat --> alpha_comb
alpha_ml --> alpha_comb
alpha_dl --> alpha_comb
alpha_nlp --> alpha_comb
alpha_comb --> signal_decay

' Alpha to Portfolio
signal_decay --> univ_filter
univ_filter --> optimizer
optimizer --> constraints
constraints --> tcost
tcost --> rebalancer
rebalancer --> tax_lot

' Risk connections
alpha_comb --> pre_risk
pre_risk --> optimizer
rt_risk --> order_mgr
var_calc --> exp_limits
stress --> margin
corr_mon --> optimizer
exp_limits --> constraints

' Portfolio to Execution
tax_lot --> order_mgr
order_mgr --> order_queue
order_queue --> sor
sor --> twap
sor --> vwap
sor --> impl_short
sor --> dark_pool

' Execution to Brokers
twap --> fix_a
vwap --> fix_a
impl_short --> fix_b
dark_pool --> rest_conn
drop_copy --> blotter

' Positions
fix_a --> pos_db
fix_b --> pos_db
rest_conn --> pos_db
pos_db --> pnl_calc
pos_db --> blotter
blotter --> recon
recon --> settle
pnl_calc --> rt_risk

' Monitoring
pnl_calc --> perf_attr
sor --> exec_analytics
sys_health --> alerts
alerts --> dashboard
perf_attr --> dashboard
exec_analytics --> dashboard
dashboard --> metrics_db

' Backtest connections
ohlcv_db --> bt_engine
bt_engine --> event_sim
event_sim --> slip_model
slip_model --> walk_fwd
walk_fwd --> monte_carlo
monte_carlo --> model_reg
model_reg --> alpha_ml
model_reg --> alpha_dl

' Infrastructure
kafka --> raw_queue
kafka --> order_queue
k8s --> istio
config --> feat_orch
vault --> fix_a
vault --> fix_b
elk --> sys_health

@enduml

